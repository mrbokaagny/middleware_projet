<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestion de Stock - Authentification </title>
    
    <link rel="stylesheet" href="{{ url_for('static', filename='css/icofont.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    
</head>
<body>

    <div class="container-fluid body-container">

        <div class="header-nav-bar">
            <nav class="d-flex justify-content-between align-items-center  nav-bar-card">
                    <div style="gap: .5em;padding:.2em" class=" d-flex justify-content-center align-items-center">
                        <img src="/assets/imgs/logo.jpg" alt="" class="d-inline-block align-text-top">
                        <span> StockPilot BDGL </span>
                        <span id="btn-toggle-web-side-menu" class="p-1"  style="cursor: pointer;margin-left:1em;font-size:25px">
                            <i class="icofont-navigation-menu"></i>
                        </span>
                    </div>
                    <div class="card-header-right-part d-flex justify-content-center align-items-center ">
                       
                        <div style="color:red" id="btn-user-log-out" class="card-header-icon power-icon d-flex justify-content-center align-items-center">
                            <span><i class="icofont-power"></i></span>
                        </div>
                    </div>
            </nav>
        </div>

        <div class="container-fluid body-content p-0 m-0">

            <div class="container-card">

                <div class="web-left-card">
                    <div class="d-flex flex-column p-0">
                        <div class="web-card-side-header d-flex flex-column justify-content-center align-items-center">
                            <div class="d-flex flex-column justify-content-center align-items-center">
                                <span style="font-weight:bolder; color:black;font-size:14px"> Administrateur </span>
                            </div>
                            <div class="d-flex flex-column justify-content-center align-items-center">
                                <span style="font-weight:bolder; color:black;font-size:14px"> Mr/Mme Boka Agny Ble </span>
                            </div>
                        </div>
                    </div>
                    <div class="list-menu-items">
                        <div style="gap:.5em" class="d-flex flex-column p-0 w-100">
    
                            <div id="btn-to-load-home-page" class="card-item d-flex align-items-center">
                                <span class="d-flex justify-content-center card-menu-icon align-items-center"><i class="icofont-dashboard"></i></span>
                                <span onclick="document.location.href='dashboard'" style="font-size:15px;padding-left:.8em">Tableau de bord </span>
                            </div>

                            <div id="btn-to-load-school-page"  class="card-item d-flex align-items-center">
                                <span class="d-flex justify-content-center card-menu-icon align-items-center"><i class="icofont-shopping-cart"></i></span>
                                <span onclick="document.location.href='products'" style="font-size:15px;padding-left:.8em"> Produits</span>
                            </div>
    
                            <div id="btn-to-load-year-page" class="card-item d-flex align-items-center">
                                <span class="d-flex justify-content-center card-menu-icon align-items-center"><i class="icofont-users-alt-4"></i></span>
                                <span onclick="document.location.href='users'" style="font-size:15px;padding-left:.8em"> Utilisateurs </span>
                            </div>

                            
                        </div>
                    </div>
                </div>

                <div  class="right-card container-fluid">

                    <div id="card-to-load-admin-content-page__">

                        <button class="btn btn-primary btn-to-active-modal-create" type="button" class="btn btn-primary">
                            <span><i class="icofont-ui-add"></i></span>
                            Ajouter un produit
                        </button>

                        <p>
                            {% with messages = get_flashed_messages(with_categories=True) %}
                                {% if messages %}
                                    {% for category, message in messages %}
                                        <div class="flash-message {{ category }}">{{ message }}</div>
                                    {% endfor %}
                                {% endif %}
                            {% endwith %}
                        </p>

                        <div class="overlay-card-to-create">
                            <div class="d-flex justify-content-center align-items-center modal-create">
                                <div class="col-sm-8 col-md-4 m-0" style="background-color:white;padding:.5em;border-radius:.5em">
                                        <div class="card-create-header d-flex justify-content-between align-items-center" style="padding:.2em">
                                            <span>Ajouter un établissement scolaire</span>
                                            <span style="width:30px;height:30px;border:1px solid red;color:red;border-radius:.2em;cursor:pointer" class="d-flex justify-content-center align-items-center btn-to-close-modal-create"><i class="icofont-ui-close"></i></span>
                                        </div>
                                        <div class="card-form-create w-100" style="position:relative;padding:.5em">
                                            <form method="POST" action="/product/create" class="row p-0 m-0" style="gap:.0em">
                                                <div class="col-8">
                                                    <label for="name"> Nom du produit </label>
                                                    <input type="texte" name="name" id="name" class="form-control">
                                                </div>
                                                <div class="col-4">
                                                    <label for="quantity"> Quantité  </label>
                                                    <input name="quantity" type="number" id="quantity" class="form-control">
                                                </div>
                                                <div class="col-12 mt-2">
                                                    <label for="price"> Prix Unitaire </label>
                                                    <input name="price" type="texte" id="price" class="form-control">
                                                </div>
                                                <div class="col-12 mt-2">
                                                    <label for="description">Description</label>
                                                    <textarea class="form-control" name="description" id="description"></textarea>
                                                </div>
                                                <div class="mt-2 text-center">
                                                    <div class="spinner-border text-dark spinner-load" role="status">
                                                    </div>
                                                    <button type="submit" class="btn btn-secondary btn-admin-create">
                                                    <i class="icofont-save"></i> Sauvegarder
                                                    </button>
                                                </div>
                                            </form>
                                        </div>
                                </div>
                            </div>
                        </div>

                        <div class="table-card container-fluid">

                            <div class="over-table-header container">Produits en stock</div>

                            <div  class="list-of-table container text-center">
                                <table class="table table-bordered data-table">
                                    <thead>
                                        <td>Nom Produit </td>
                                        <td>Quantité</td>
                                        <td>Prix Unitaire</td>
                                        <td>Description</td>
                                        <td>Action</td>
                                    </thead>
                                    <tbody>
                                        {% for product in products %}
                                            <tr>
                                                <td>{{ product.name }}</td>
                                                <td>{{ product.stock }}</td>
                                                <td>{{ product.price }}</td>
                                                <td>{{ product.description }}</td>
                                                <td class="d-flex justify-content-around align-items-center btn-fade-modal-update">
                                                    <span onclick="product_detail('{{ product.id|int }}')" class="d-flex justify-content-center align-items-center table-list-icon icon-edit btn-fade-modal-update"><i class="icofont-edit"></i></span>
                                                </td>
                                            </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>

                        </div>

                        <div class="modal-to-update-data">
                            <div class="d-flex justify-content-center align-items-center modal-create">
                                <div class="col-sm-8 col-md-4 m-0" style="background-color:white;padding:.5em;border-radius:.5em">
                                        <div class="card-create-header d-flex justify-content-between align-items-center" style="padding:.2em">
                                            <span>Modifier les informations d'un produit</span>
                                            <span style="width:30px;height:30px;border:1px solid red;color:red;border-radius:.2em;cursor:pointer" class="d-flex justify-content-center align-items-center btn-to-close-modal-create"><i class="icofont-ui-close"></i></span>
                                        </div>
                                        <div class="card-form-create w-100" style="position:relative;padding:.5em">
                                            
                                            <form id="content-of-update-product-modal" method="POST" action="/product/update" class="row p-0 m-0" style="gap:.0em">
                                                <div class="col-12">
                                                    <label for="name"> Nom du produit </label>
                                                    <input type="texte" name="name" id="upd_name" class="form-control">
                                                </div>
                                                <div class="col-12 mt-2">
                                                    <label for="quantity"> Quantité  </label>
                                                    <input name="quantity" type="number" id="upd_quantity" class="form-control">
                                                </div>
                                                <div class="col-12 mt-2">
                                                    <label for="price"> Prix Unitaire </label>
                                                    <input name="price" type="texte" id="upd_price" class="form-control">
                                                </div>
                                                <div class="col-12 mt-2">
                                                    <label for="description">Description</label>
                                                    <textarea class="form-control" name="description" id="upd_description"></textarea>
                                                </div>
                                                <input type="hidden" id="product_id" name="product_id">
                                                <div class="mt-2 text-center">
                                                    <div class="spinner-border text-dark spinner-load" role="status">
                                                    </div>
                                                    <button type="submit" class="btn btn-secondary btn-admin-create">
                                                    <i class="icofont-save"></i> Sauvegarder
                                                    </button>
                                                </div>
                                            </form>

                                            <p id="loading-product-data" class="text-center">
                                                Chargement des informations du produit
                                            </p>
                                        </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    
       
                </div>

            </div>

        </div>

    </div>
    
</body>
<script src="{{ url_for('static', filename='js/jquery.js') }}"></script>
<script src="{{ url_for('static', filename='js/admin.js') }}"></script>
<script>
    function product_detail(id){
        
        $("#card-to-load-admin-content-page__ #loading-product-data").css("display", "initial");
        $("#card-to-load-admin-content-page__ #content-of-update-product-modal").css("display", "none");

        $.ajax({
            url: '/product/'+id,
            type: 'GET',
            success: function(data){

                $("#card-to-load-admin-content-page__ #content-of-update-product-modal").css("display", "block");
                $("#card-to-load-admin-content-page__ #loading-product-data").css("display", "none");

                $("#upd_name").val(data.name)
                $("#upd_quantity").val(data.stock)
                $("#upd_price").val(data.price)
                $("#upd_description").val(data.description)
                $("#product_id").val(data.id)	
            },
            error: function(error){
                alert("Une erreur s'est produite lors de la récupération des informations du produit")
            }
        })
    }
</script>
</html>
